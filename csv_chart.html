<!DOCTYPE HTML>
<html>

<head>
  <script>

window.onload = function() {

  const HEYA_COUNT = 3;

  var heyaNames = ["Dewanoumi Ichimon", "Nishonoseki Ichimon", 
  "Tatsunami Ichimon", "Tokitsukaze Ichimon", "Takasago Ichimon",
    "Dewanoumi", "Fujishima", "Futagoyama", "Irumagawa", "Kasugano", "Kise", 
    "Musashigawa", "Onoe", "Sakaigawa", "Shikihide", "Takekuma", "Tamanoi", 
    "Tatsunami", "Yamahibiki",
  "Hanaregoma", "Kataonami", "Minato", "Naruto", "Nishiiwa", "Nishonoseki", 
  "Onomatsu", "Oshiogawa", "Otake", "Sadogatake", "Shibatayama", 
  "Shikoroyama", "Tagonoura", "Takadagawa", "Tokiwayama",
    "Asahiyama", "Asakayama", "Isegahama", "Miyagino", "Oshima",
  "Arashio", "Isenoumi", "Michinoku", "Oitekaze", "Tokitsukaze",
    "Hakkaku", "Kokonoe", "Nishikido", "Takasago"]

  var ichimonDps = [];

  // Initialize array of dataPoint arrays with sekitori
  var dps = Create2DArray(HEYA_COUNT);

  // Initialize array of dataPoint arrays with no sekitori
  var dpsB = Create2DArray(HEYA_COUNT);

  var chart = new CanvasJS.Chart("chartContainer");

  chart.options = {
    //theme: "light2",
    backgroundColor: "transparent",
    animationEnabled: false,
    exportEnabled: true,
    zoomEnabled: true,
    zoomType: "x"
  };

  chart.options.title = {
    text: "Description",
    fontFamily: "Verdana"
  };

  chart.options.axisX = {
    title: "date",
    titleFontFamily: "Verdana",
    labelFontFamily: "Arial",
    labelFontSize: 14,
    titleFontSize: 20,
    titleFontColor: "red",
    tickLength: 5,
    tickColor: "black",
    lineColor: "black",
    maximum: new Date(2022, 8),
    //viewportMinimum: new Date(1898, 5),
    //viewportMaximum: new Date(2022, 7),
    //margin: 10,
    //labelFormatString: "YYYY MM"
    //interval: 5,
    //intervalType: "year",
    labelFormatter: function(e) {
      return CanvasJS.formatDate(e.value, "YYYY.MM");
    }
  };

  chart.options.axisX.stripLines = [];

  chart.options.axisX.stripLines[0] = {
    //value: new Date(1988, 1),
    startValue: new Date(1898, 4),
    endValue: new Date(1988, 1),               
    color: "red",
    opacity: .1
  }; 
  chart.options.axisX.stripLines[1] = {
    startValue: new Date(1898, 4),
    endValue: new Date(1934, 2),               
    color: "red",
    opacity: .1
  }; 
  chart.options.axisX.stripLines[2] = {
    value: new Date(1957, 11),
    label: "6BPY era starts"
  };
  chart.options.axisX.crosshair = {
    enabled: true,
    labelFormatter: function(e) {
      return CanvasJS.formatDate(e.value, "YYYY.MM");
    }
  };

  chart.options.axisY = {
    title: "total rikishi",
    titleFontFamily: "Verdana",
    labelFontFamily: "arial",
    labelFontSize: 14,
    titleFontSize: 20,
    titleFontColor: "red",
    includeZero: true,
    tickLength: 0,
    lineColor: "black",
    gridColor: "#A9A9A9",
    minimum: 0
  };

  chart.options.legend = {
    cursor: "pointer",
    fontFamily: "Trebuchet MS",
    fontWeight: "bold ",
    horizontalAlign: "center",
    //itemWidth: 110,
    //dockInsidePlotArea: true,
    itemmouseover: function(e) {
      e.dataSeries.lineThickness = 3;
      e.dataSeries.fillOpacity = .5;
      e.dataSeries.indexLabelFontWeight = "bold";
      e.chart.render();
    },
    itemmouseout: function(e) {
      e.dataSeries.lineThickness = 2;
      e.dataSeries.fillOpacity = .4;
      e.dataSeries.indexLabelFontWeight = "normal";
      e.chart.render();
    },
    itemclick: function(e) {
      if (e.dataSeries.name === "Dewanoumi Ichimon") {
        if (e.dataSeries.visible) {
          e.dataSeries.visible = false;
          for (var i = 1; i < HEYA_COUNT + 1; i++)
            chart.options.data[i].visible = false;
        } else {
          e.dataSeries.visible = true;
          for (var i = 1; i < HEYA_COUNT + 1; i++)
            chart.options.data[i].visible = true;
        }
      } else if (e.dataSeries.visible)
        e.dataSeries.visible = false;
      else
        e.dataSeries.visible = true;
      e.chart.render();
    }
  };

  chart.options.toolTip = {
    shared: false,
    fontSize: 13,
    cornerRadius: 8,
    fontFamily: "Verdana",
    //borderColor: "black",
    contentFormatter: tooltipNoSekitori
  };

  chart.options.data = [];

  for (var i = 0; i < HEYA_COUNT + 1; i++) {
    if (i == 0) {
      chart.options.data[i] = {
        name: heyaNames[i],
        legendText: "- {name} -",
        type: "rangeArea",
        showInLegend: true,
        toolTipContent: " ",
        highlightEnabled: false,
        legendMarkerType: "none",
        markerSize: 0,
        visible: true,
        dataPoints: ichimonDps
      }
    }
    else {
      chart.options.data[i] = {
        name: heyaNames[i+4],
        type: "spline",
        markerSize: 0,
        cursor: "pointer",
        showInLegend: true,
        fillOpacity: .4,
        lineThickness: 2,
        indexLabelFontSize: 12,
        indexLabelLineThickness: 1.5,
        indexLabelLineColor: "black",
        legendMarkerType: "circle",
        visible: true,
        indexLabelLineDashType: "dot",
        indexLabelFormatter: function(e) {
          if (e.index !== 1 && e.dataPoint.label)
            return e.dataPoint.label;
          else return "";
        },
        click: function(e) {
          window.open(e.dataPoint.url);
        },
        dataPoints: dpsB[i-1]
      };
    }
  }

  
  function Create2DArray(rows) {
    var arr = [];

    for (var i = 0; i < rows; i++) {
       arr[i] = [];
    }

    return arr;
  }

  // Checkbox for toggling between sekitori and sekitoriless dataSeries
  var sekitoriCheckbox = document.querySelector("input[name=checkbox]");
  sekitoriCheckbox.addEventListener("change", toggleSekitori);

  function toggleSekitori() {
    if (this.checked) {
      for (var i = 1; i < HEYA_COUNT + 1; i++) {
        chart.data[i].set("type", "rangeSplineArea");
        chart.options.data[i].dataPoints = dps[i-1];
      }
      chart.options.toolTip.contentFormatter = tooltipSekitori;
    } else {
      for (var i = 1; i < HEYA_COUNT + 1; i++) {
        chart.data[i].set("type", "spline");
        chart.options.data[i].dataPoints = dpsB[i-1];
      }
      chart.options.toolTip.contentFormatter = tooltipNoSekitori;
    }
    chart.render();
  }


  function tooltipNoSekitori(e) {
    var str = "";

    for (var i = 0; i < e.entries.length; i++) {
      var temp = CanvasJS.formatDate(e.entries[i].dataPoint.x, "YYYY.MM") + 
      " - <strong>" + e.entries[i].dataSeries.name + 
      "</strong><br/>Shisho: " + e.entries[i].dataPoint.shisho + 
      "<br/><strong>" + e.entries[i].dataPoint.y + "</strong> rikishi";
      str = str.concat(temp);
    }

    return str;
  }


  function tooltipSekitori(e) {
    var str = "";

    for (var i = 0; i < e.entries.length; i++) {
      var temp = CanvasJS.formatDate(e.entries[i].dataPoint.x, "YYYY.MM") + 
      " - <strong>" + e.entries[i].dataSeries.name + "</strong><br/>Shisho: " + 
      e.entries[i].dataPoint.shisho + "<br/><strong>" + 
      e.entries[i].dataPoint.y[0] + "</strong> rikishi, <strong>" + 
      (e.entries[i].dataPoint.y[0] - e.entries[i].dataPoint.y[1]) + 
      "</strong> sekitori<br/>";
      str = str.concat(temp);
    }

    return str;
  }


  $.get("https://raw.githubusercontent.com/andre1670/andre1670/main/chart.csv", 
    getDataPointsFromCSV);

  function getDataPointsFromCSV(csv) {
    var csvLines = heya = date = [];
    var datas = Create2DArray(HEYA_COUNT);

    csvLines = csv.split(/[\r?\n|\r|\n]+/);
    for (var i = 1; i < csvLines.length; i++) {
      if (csvLines[i].length > 0) {
        heya = csvLines[i].split(",");
        date = heya[0].split(".");

        for (var j = 0; j < HEYA_COUNT; j++) {
          datas[j] = heya[j+1].split("-");
          if (heya[j+1] !== "") {
            dps[j].push({
              shisho: datas[j][2],
              label: datas[j][3],
              url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + date[0] + 
              date[1] + "&heya=" + datas[j][4] + "&shusshin=-1",
              x: new Date(date[0], date[1] - 1),
              y: [parseInt(datas[j][0]), parseInt(datas[j][0]) - 
              parseInt(datas[j][1])]
            });
            dpsB[j].push({
              shisho: datas[j][2],
              label: datas[j][3],
              url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + date[0] + 
              date[1] + "&heya=" + datas[j][4] + "&shusshin=-1",
              x: new Date(date[0], date[1] - 1),
              y: parseInt(datas[j][0])
            });
            if (i === csvLines.length - 2) {
              ichimonDps.push({
                x: new Date(date[0], date[1] - 1),
                y: [0, 0]
              });
            }
          }
        }
      }
    }
    chart.render();
  }

  document.getElementById("button").addEventListener("click", function(){
    var currentMin = chart.axisX[0].get("viewportMinimum");
    var currentMax = chart.axisX[0].get("viewportMaximum");
    var yearMax = currentMax.getFullYear();
    var monthMax = currentMax.getMonth();

    document.getElementById("display").innerHTML = currentMin + " " + currentMax;
    chart.axisX[0].set("viewportMinimum", new Date(yearMax - 5, monthMax));

  })

}

    </script>
</head>

<body>
  <div id="chartContainer" style="height: 450px; width: 100%;">
    <center><img src="https://i.imgur.com/Pdr7Mvk.gif" id="loader"/><br/>Loading...</center>
  </div><label><input id="toggleSekitori" type="checkbox" name="checkbox" value="">Enable Sekitori</label>
  <button id="button">5 yrs</button>
  <span id="display"></span>
  <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

</html>
