<!DOCTYPE HTML>
<html>
<head>  
<script>
window.onload = function () {

    const HEYA_COUNT = 3;

    for (var i = 1; i <= HEYA_COUNT; i++) {
        this["dps" + i] = [];
    }
     
    var chart = new CanvasJS.Chart("chartContainer", {
        // backgroundColor: "#2A3E50",
        theme: "light1",
        backgroundColor: "#F5DEB3",
        animationEnabled: false,
        exportEnabled: true,
        zoomEnabled: true,
        zoomType: "x",

        title: {
            text: "Description"
        },
        axisY: {
            includeZero: true,
            title: "rikishi number"
        },
        axisX: {
            title: "date",
            includeZero: false,
            //labelFormatString: "YYYY MM"
            // interval: 6
            labelFormatter: function(e) {
                return CanvasJS.formatDate(e.value, "YYYY.MM");
            }   
        },
        legend: {
            cursor: "pointer",
            // dockInsidePlotArea: true,
            // itemclick: toggleDataSeries
            itemmouseover: function(e) {
                e.dataSeries.lineThickness = e.chart.data[e.dataSeriesIndex].lineThickness * 2;
                e.dataSeries.markerSize = e.chart.data[e.dataSeriesIndex].markerSize + 2;
                e.dataSeries.fillOpacity = .5;
                e.chart.render();
            },
            itemmouseout: function(e) {
                e.dataSeries.lineThickness = e.chart.data[e.dataSeriesIndex].lineThickness / 2;
                e.dataSeries.markerSize = e.chart.data[e.dataSeriesIndex].markerSize - 2;
                e.dataSeries.fillOpacity = .3;
                e.chart.render();
            },
            itemclick: function(e) {       
                var totalVisibleSeries = 0;
                for(var i = 0; i < e.chart.data.length; i++)  
                    if(e.chart.data[i].visible)
                        totalVisibleSeries++;
                    if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                        if(totalVisibleSeries > 1)
                            e.dataSeries.visible = false;
                    } else {
                        e.dataSeries.visible = true;
                    }
                    e.chart.render();
            }
        },
        toolTip: {
            shared: false,
            cornerRadius: 10,
            xValueFormatString: "YYYY MM",
            contentFormatter: function(e) {
                var str = "";
                for (var i = 0; i < e.entries.length; i++) {
                    var  temp = CanvasJS.formatDate(e.entries[i].dataPoint.x, "YYYY.MM") + " - " + "<strong>" + e.entries[i].dataSeries.name + "</strong><br/>Shisho: " + e.entries[i].dataPoint.label + "<br/>" + e.entries[i].dataPoint.y[0] + " rikishi, " + (e.entries[i].dataPoint.y[0] - e.entries[i].dataPoint.y[1]) + " sekitori<br/>";
                    str = str.concat(temp);
                }
                return (str);
            }
        },
        data: [{
            type: "rangeSplineArea",
            //legendMarkerType: "triangle",
            showInLegend: true,
            name: "Dewanoumi",
            fillOpacity: .3,
            lineThickness: 1,
            indexLabelFormatter: function(e) {
                if (e.dataPoint.indexLabel == null)
                    return '';           
                else
                    return e.dataPoint.indexLabel;               
            },
            indexLabelFontSize: 12,
            dataPoints: dps1
        },
        {
            type: "rangeSplineArea",
            //legendMarkerType: "triangle",
            showInLegend: true,
            name: "Fujishima",
            fillOpacity: .3,
            lineThickness: 1,
            indexLabelFormatter: function(e) {
                if (e.dataPoint.indexLabel == null)
                    return '';           
                else
                    return e.dataPoint.indexLabel;               
            },
            indexLabelFontSize: 12,
            dataPoints: dps2
        },
        {
            type: "rangeSplineArea",
            //legendMarkerType: "triangle",
            showInLegend: true,
            name: "Futagoyama",
            fillOpacity: .3,
            lineThickness: 1,
            indexLabelFormatter: function(e) {
                if (e.dataPoint.indexLabel == null)
                    return '';           
                else
                    return e.dataPoint.indexLabel;               
            },
            indexLabelFontSize: 12,
            dataPoints: dps3
        }]
    });
    
    

    /*chart.options.data[0].click = function(e) { 
        var dataSeries = e.dataSeries;
        var dataPoint = e.dataPoint;
        
        window.open(dataPoint.link,'_blank');      
    };*/

    var button = document.getElementById( "toggleDewanoumi" );
    button.addEventListener( "click",  toggleDewanoumi);

    function toggleDewanoumi(e) {
        var data = chart.data;

        for(var i = 0; i < 3; i++) {
            chart.options.data[i].visible = !data[i].visible;
        }

        chart.render();
    }

    /*$("#slider1").slider({
        range: true,
        min: chart.axisX[0].get("minimum"),
        max: chart.axisX[0].get("maximum"),
        values: [Date(1899, 05), Date(2022, 05)], //Defalt zoom state
        slide: function( event, ui ) {
            chart.axisX[0].set("viewportMinimum", ui.values[0], false);
            chart.axisX[0].set("viewportMaximum", ui.values[1]);    
        }
    });

    chart.axisX[0].set("viewportMinimum", $("#slider1").slider("values", 0), false);
    chart.axisX[0].set("viewportMaximum", $("#slider1").slider("values", 1));
    */
    var button = document.getElementById( "changeType" );
    button.addEventListener( "click",  changeType);

    function changeType(e) {
        chart.data[0].set("type", "spline", false);
        chart.data[0].set("name", "My Chart");
        this.disabled = true;

        chart.render();
    }

    $.get("https://raw.githubusercontent.com/andre1670/sumo-heya-chart/main/chart.csv", getDataPointsFromCSV);
    
    function getDataPointsFromCSV(csv) {
        var csvLines = points = date = [];
        for (var i = 1; i <= HEYA_COUNT; i++) {
            this["rikishiNum" + i] = [];
        }

        csvLines = csv.split(/[\r?\n|\r|\n]+/);
        for (var i = 1; i < csvLines.length; i++) {
            if (csvLines[i].length > 0) {
                points = csvLines[i].split(",");
                date = points[0].split(".");
                /*for (var j = 1; j <= HEYA_COUNT; j++) {
                    this("rikishiNum" + j) = points[j].split('-');
                    this("dataPoints" + j).push({
                        label: points[0],
                        y: parseInt(this("rikishiNum" + j)[0]);
                    })
                }*/
                /*for (var j = 1; j <= HEYA_COUNT; j++) {
                    eval("rikishiNum" + j + " = " + points[j].split("-") + ';');
                    eval("dataPoints" + j + '.' + push({
                        label: points[0],
                        y: parseInt + "(rikishiNum" + j + ")[0];")
                    }))
                }*/
                rikishiNum1 = points[1].split("-");
                rikishiNum2 = points[2].split("-");
                rikishiNum3 = points[3].split("-");
                dps1.push({
                    label: rikishiNum1[2],
                    indexLabel: rikishiNum1[3],
                    x: new Date(date[0], date[1]-1),
                    y: [parseInt(rikishiNum1[0]), parseInt(rikishiNum1[0]) - parseInt(rikishiNum1[1])]
                });
                dps2.push({
                    label: rikishiNum2[2],
                    indexLabel: rikishiNum2[3],
                    x: new Date(date[0], date[1]-1),
                    y: [parseInt(rikishiNum2[0]), parseInt(rikishiNum2[0]) - parseInt(rikishiNum2[1])]
                });
                dps3.push({
                    label: rikishiNum3[2],
                    indexLabel: rikishiNum3[3],
                    x: new Date(date[0], date[1]-1),
                    y: [parseInt(rikishiNum3[0]), parseInt(rikishiNum3[0]) - parseInt(rikishiNum3[1])]
                });
            }
        }
        chart.render();
    }
}

</script>
</head>
<body>
<div id="chartContainer" style="height: 450px; width: 100%;"></div>
<button id="toggleDewanoumi" type = "button" >Dewanoumi ichimon</button>
</div><button id="changeType">Change Chart Type</button>
        <span id="display"></span>
<script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>