<!DOCTYPE HTML>
<html lang="en">
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <script>

const HEYA_COUNT = 43;
const DEF_HEYA_COUNT = 66;

var hNamesAlpha = ["All", "Arashio", "Asahiyama[2]", "Asakayama", "Dewanoumi",
"Fujishima[2]", "Futagoyama", "Hakkaku", "Hanaregoma[2]", "Irumagawa", "Isegahama[3]", 
"Isenoumi", "Kasugano", "Kataonami", "Kise[1]", "Kokonoe", "Michinoku[2]", "Minato", 
"Miyagino[2]", "Musashigawa", "Naruto", "Nishiiwa", "Nishikido", "Nishonoseki[3]", 
"Oitekaze[4]", "Onoe", "Ōnomatsu", "Ōshima[2]", "Oshiogawa[3]", "Ōtake", "Sadogatake[2]", 
"Sakaigawa", "Shibatayama", "Shikihide[3]", "Shikoroyama", "Tagonoura[3]", 
"Takadagawa", "Takasago", "Takekuma[3]", "Tamanoi[2]", "Tatsunami", "Tokitsukaze", 
"Tokiwayama", "Yamahibiki"
];

var hNamesOld = ["All", "Dewanoumi", "Takasago", "Tatsunami", "Kasugano", 
"Tokitsukaze", "Isenoumi", "Sadogatake[2]", "Miyagino[2]", "Ōshima[2]", "Kataonami", 
"Kokonoe", "Ōtake", "Michinoku[2]", "Takadagawa", "Isegahama[3]", "Fujishima[2]", 
"Minato", "Yamahibiki", "Tagonoura[3]", "Tamanoi[2]", "Hanaregoma[2]", "Shikihide[3]", 
"Irumagawa", "Hakkaku", "Ōnomatsu", "Sakaigawa", "Oitekaze[4]", "Shibatayama", 
"Arashio", "Nishikido", "Kise[1]", "Shikoroyama", "Tokiwayama", "Onoe", 
"Musashigawa", "Asakayama", "Asahiyama[2]", "Naruto", "Nishiiwa", "Futagoyama", 
"Nishonoseki[3]", "Takekuma[3]", "Oshiogawa[3]"
];

var hNamesDefAlpha = ["Araiso", "Asahiyama[1]", "Azumazeki", "Fujishima[1]", 
"Furiwake", "Futagoyama[1]", "Hanakago[1]", "Hanakago[2]", "Hanakago[3]", 
"Hanaregoma[1]", "Hatachiyama", "Isegahama[2]", "Izutsu", "Kabutoyama", 
"Kagamiyama", "Kasugayama[1]", "Kasugayama[2]", "Kasugayama[3]", "Kiriyama", 
"Kise[1]", "Kumagatani[1]", "Kumagatani[2]", "Magaki[2]", "Magaki[3]", 
"Michinoku[1]", "Mihogaseki[1]", "Mihogaseki[2]", "Minatogawa[1]", "Minatogawa[2]", 
"Minezaki", "Miyagino[1]", "Nakagawa[3]", "Nakagawa[4]", "Nakamura[1]", 
"Nakamura[2]", "Nishikijima", "Nishonoseki[2]", "Oguruma", "Oitekaze[3]", 
"Onaruto[1]", "Onaruto[2]", "Onogawa", "Ōshima[1]", "Oshiogawa[2]", "Oyama", "Sadogatake[1]", 
"Sanoyama[1]", "Sanoyama[2]", "Shikihide[2]", "Tagonoura[2]", "Takanohana", 
"Takashima[1]", "Takashima[2]", "Takekuma[1]", "Takekuma[2]", "Tamanoi[1]", 
"Tanigawa[1]", "Tanigawa[2]", "Tatekawa", "Tatsutagawa", "Tatsutayama", "Tomozuna", 
"Urakaze", "Wakafuji", "Wakamatsu", "Yamawake",
];

var hNamesDefOld = ["Nishikijima", "Asahiyama[1]", "Onogawa", "Wakamatsu", "Isegahama[2]", "Nishonoseki[2]", 
"Oitekaze[3]", "Oyama", "Mihogaseki[1]", "Hanakago[1]", "Minatogawa[1]", "Sanoyama[2]", 
"Kasugayama[1]", "Kise[1]", "Magaki[2]", "Nakagawa[3]", "Tatekawa", "Onaruto[1]", "Takashima[1]", 
"Takanohana", "Tanigawa[1]", "Kagamiyama", "Tatsutagawa", "Izutsu", "Oshiogawa[2]", 
"Onaruto[2]", "Kumagatani[1]", "Ōshima[1]", "Hanaregoma[1]", "Fujishima[1]", "Magaki[3]", "Azumazeki", 
"Nakamura[1]", "Oguruma", "Minezaki", "Kabutoyama", "Hanakago[2]", "Araiso", 
"Takashima[2]", "Hatachiyama", "Kiriyama", "Kasugayama[2]", "Takekuma[1]", 
"Tagonoura[2]", "Nakagawa[4]"
"Urakaze", "Nakamura[2]", 
"Michinoku[1]", "Sanoyama[1]", "Miyagino[1]", "Kumagatani[2]", "Takekuma[2]", 
"Shikihide[2]", "Yamawake", "Wakafuji", "Furiwake", "Minatogawa[1]", "Kasugayama[3]", 
"Tamanoi[1]", "Tomozuna", "Hanakago[3]", "Futagoyama[1]", "Tatsutayama", "Mihogaseki[1]", 
"Tanigawa[2]", "Sadogatake[1]"
];

var hNamesDefClo = ["Oguruma", "Kagamiyama", "Azumazeki", "Minezaki", "Nakagawa[4]", 
"Izutsu", "Takanohana", "Kasugayama[3]", "Asahiyama[1]", "Mihogaseki[2]", "Magaki[3]", 
"Hanaregoma[1]", "Nishonoseki[2]", "Nakamura[2]", "Hanakago[3]", "Ōshima[1]", "Tagonoura[2]", 
"Takashima[2]", "Kiriyama", "Araiso", "Isegahama[2]", "Hatachiyama", "Oshiogawa[2]", 
"Takekuma[2]", "Kabutoyama", "Wakamatsu", "Tatsutagawa", "Kise[1]", "Kumagatani[2]", 
"Onaruto[2]", "Fujishima[1]", "Kasugayama[2]", "Oyama", "Hanakago[2]", "Takashima[1]", "Magaki[2]", "Nakagawa[3]", 
"Tanigawa[2]", "Minatogawa[2]", "Onogawa", "Oitekaze[3]", 
"Nishikijima", "Sanoyama[2]", "Tatekawa", "Onaruto[1]", "Urakaze", "Nakamura[1]", 
"Michinoku[1]", "Sanoyama[1]", "Miyagino[1]", "Kumagatani[1]", "Takekuma[1]", 
"Shikihide[2]", "Yamawake", "Wakafuji", "Furiwake", "Minatogawa[1]", "Kasugayama[1]", 
"Tamanoi[1]", "Tomozuna", "Hanakago[1]", "Futagoyama[1]", "Tatsutayama", "Mihogaseki[1]", 
"Tanigawa[1]", "Sadogatake[1]"
];

var dataColors = ["#d74bb1", "#4ccc61", "#7e52d2", "#5dae2d", "#a746bf", 
"#afbb35", "#3959cf", "#e6a01e", "#8274f1", "#8bc35e", "#d574e7", "#44a14d", 
"#ea377d", "#5bca89", "#b52479", "#2d7a2c", "#834aaf", "#72962e", "#4779ea", 
"#d8ad41", "#5b5cbb", "#e29134", "#458ee8", "#e95b35", "#54bce6", "#b72f20", 
"#4acaad", "#ce2c57", "#329f75", "#e14f92", "#347f4e", "#ab82e5", "#5d7821", 
"#d076c6", "#9e8d27", "#644999", "#e07931", "#415ea7", "#be5f2a", "#7f89dc", 
"#5f6211", "#7b68b9", "#9dbc72", "#9e4593", "#6c995c", "#da4248", "#3bbcc3", 
"#9d4317", "#599fd7", "#b27a30", "#3176ae", "#ee8765", "#1a6447", "#e86176", 
"#296437", "#e98ec7", "#507738", "#cd96da", "#476025", "#d16799", "#76b991", 
"#b1394e", "#37846c", "#a13f6a", "#beb46b", "#7b488b", "#8d8444", "#a4a4e5", 
"#7b5d16", "#8974b2", "#62612c", "#a7679a", "#daa370", "#5a5f94", "#966536", 
"#d795b8", "#884729", "#e47f9b", "#c77c60", "#894b67", "#e68d8b", "#8f3f4a", 
"#af5448", "#b25e68"];


window.onload = function() {

  // Initialize array of dataPoint arrays with no sekitori
  var dps = Create2DArray(HEYA_COUNT + 1 + DEF_HEYA_COUNT);

  // Initialize array of dataPoint arrays with sekitori
  var dpsB = Create2DArray(HEYA_COUNT + 1 + DEF_HEYA_COUNT);


  CanvasJS.addColorSet("heyaColors", dataColors);

  var viewportX = document.getElementById("viewportX");

  var chart = new CanvasJS.Chart("chartContainer");

  chart.options = {
    colorSet: "heyaColors",
    backgroundColor: "white", // #fffedf
    animationEnabled: false,
    exportEnabled: true,
    zoomEnabled: true,
    zoomType: "x",
    rangeChanged: function(e) {
      var viewportRange = "";
      if (e.trigger === "reset") {
        viewportRange = viewportRange + 
        CanvasJS.formatDate(e.chart.axisX[0].viewportMinimum, "YYYY.MM") + 
        " - " + CanvasJS.formatDate(e.chart.axisX[0].viewportMaximum, "YYYY.MM");
      } else {
        viewportRange = viewportRange + 
        CanvasJS.formatDate(e.axisX[0].viewportMinimum, "YYYY.MM") + 
        " - " + CanvasJS.formatDate(e.axisX[0].viewportMaximum, "YYYY.MM");
      }
        viewportX.setAttribute("value", viewportRange);
    }
  };

  chart.options.title = {
    text: null
  };

  chart.options.axisX = {
    title: "date",
    titleFontFamily: "Verdana",
    titleFontWeight: "bold",
    labelFontFamily: "Arial",
    labelFontSize: 14,
    titleFontSize: 16,
    tickLength: 6,
    tickThickness: 1.5,
    lineThickness: 1,
    lineColor: "black",
    gridColor: "#A9A9A9",
    gridDashType: "solid",
    labelFormatter: function(e) {
      return CanvasJS.formatDate(e.value, "YYYY.MM");
    }
  };

  chart.options.axisX.stripLines = [];

  chart.options.axisX.stripLines[0] = {
    startValue: new Date(1757, 9),
    endValue: new Date(1988, 1),
    color: "red",
    opacity: .08
  };
  chart.options.axisX.stripLines[1] = {
    startValue: new Date(1757, 9),
    endValue: new Date(1934, 2),
    color: "red",
    opacity: .08
  };

  chart.options.axisX.crosshair = {
    enabled: true,
    labelFontFamily: "Arial",
    snapToDataPoint: true,
    valueFormatString: "YYYY.MM",
    lineDashType: "longDash"
  }

  chart.options.axisY = {
    title: "total rikishi",
    titleFontFamily: "Verdana",
    titleFontWeight: "bold",
    labelFontFamily: "Arial",
    labelFontSize: 14,
    titleFontSize: 16,
    lineThickness: 1,
    lineColor: "black",
    includeZero: true,
    tickLength: 0,
    lineColor: "black",
    gridColor: "#A9A9A9"
  };

  chart.options.toolTip = {
    fontFamily: "Arial",
    shared: false,
    cornerRadius: 8,
    contentFormatter: tooltipNoSekitori
  };

  chart.options.data = [];

  for (var i = 0; i <= HEYA_COUNT; i++) {
    chart.options.data[i] = {
      name: hNamesAlpha[i],
      type: "line",
      markerSize: 0,
      visible: false,
      cursor: "pointer",
      click: function(e) {
        window.open(e.dataPoint.url);
      },
      dataPoints: dps[i]
    };
  }

  for (var i = HEYA_COUNT + 1; i < DEF_HEYA_COUNT + HEYA_COUNT + 1; i++) {
    chart.options.data[i] = {
      name: hNamesDefAlpha[i - (HEYA_COUNT + 1)],
      type: "line",
      markerSize: 0,
      visible: false,
      cursor: "pointer",
      click: function(e) {
        window.open(e.dataPoint.url);
      },
      dataPoints: dps[i]
    };
  }

  function updateViewportText() {
    if (chart.axisX[0].get("viewportMinimum") === Infinity) {
      viewportX.setAttribute("value", "");
    } else {
      var viewportRange = "";
      viewportRange = viewportRange + 
      CanvasJS.formatDate(chart.axisX[0].viewportMinimum, "YYYY.MM") +
      " - " + CanvasJS.formatDate(chart.axisX[0].viewportMaximum, "YYYY.MM");
      viewportX.setAttribute("value", viewportRange);
    }
  }

  function Create2DArray(rows) {
    var arr = [];

    for (var i = 0; i < rows; i++) {
      arr[i] = [];
    }

    return arr;
  }


  // Checkbox for toggling between sekitori and sekitoriless dataSeries
  var sekitoriCheckbox = document.querySelector("input[name=checkbox]");
  sekitoriCheckbox.addEventListener("change", toggleSekitori);

  function toggleSekitori() {
    if (this.checked) {
      for (var i = 0; i < DEF_HEYA_COUNT + HEYA_COUNT + 1; i++) {
        if (chart.options.data[i].visible === true) {
          chart.data[i].set("type", "rangeArea");
          chart.options.data[i].dataPoints = dpsB[i];
        }
      }
      chart.options.toolTip.contentFormatter = tooltipSekitori;
    } else {
      for (var i = 0; i < DEF_HEYA_COUNT + HEYA_COUNT + 1; i++) {
        if (chart.options.data[i].visible === true) {
          chart.data[i].set("type", "line");
          chart.options.data[i].dataPoints = dps[i];
        }
      }
      chart.options.toolTip.contentFormatter = tooltipNoSekitori;
    }
    chart.render();
  }

  function tooltipNoSekitori(e) {
    var str = "";

    for (var i = 0; i < e.entries.length; i++) {
      var temp = CanvasJS.formatDate(e.entries[i].dataPoint.x, "YYYY.MM") +
        " - <strong>" + e.entries[i].dataSeries.name + "</strong>";
      if (e.entries[i].dataPoint.prevHeyaName !== "")
        temp = temp + "<br/>(then " + e.entries[i].dataPoint.prevHeyaName + ")";
      if (e.entries[i].dataPoint.shisho !== "")
        temp = temp + "<br/>Shishō: " + e.entries[i].dataPoint.shisho;

      temp = temp + "<br/><strong>" + e.entries[i].dataPoint.y +
        "</strong> rikishi";
      str = str.concat(temp);
    }

    return str;
  }

  function tooltipSekitori(e) {
    var str = "";

    for (var i = 0; i < e.entries.length; i++) {
      var temp = CanvasJS.formatDate(e.entries[i].dataPoint.x, "YYYY.MM") +
        " - <strong>" + e.entries[i].dataSeries.name + "</strong>";
      if (e.entries[i].dataPoint.prevHeyaName !== "")
        temp = temp + "<br/>(then " + e.entries[i].dataPoint.prevHeyaName + ")";
      if (e.entries[i].dataPoint.shisho !== "")
        temp = temp + "<br/>Shishō: " + e.entries[i].dataPoint.shisho;

      temp = temp + "<br/><strong>" + e.entries[i].dataPoint.y[0] +
        "</strong> rikishi, <strong>" + (e.entries[i].dataPoint.y[0] -
          e.entries[i].dataPoint.y[1]) + "</strong> sekitori<br/>";
      str = str.concat(temp);
    }

    return str;
  }

  $.get("https://raw.githubusercontent.com/chiyotasuke/heya-graph/main/heya_data.csv",
    getDataActive);

  function getDataActive(csv) {
    var csvLines = heya = dates = [];
    var hData = Create2DArray(HEYA_COUNT + 1);

    csvLines = csv.split(/[\r?\n|\r|\n]+/);
    for (var i = 1; i < csvLines.length; i++) {
      if (csvLines[i].length > 0) {
        heya = csvLines[i].split(",");
        dates = heya[0].split(".");
        for (var j = 0; j <= HEYA_COUNT; j++) {
          hData[j] = heya[j+1].split("-");
          if (heya[j+1] !== "") {
            if (hData[j][0] === "") {
              dps[j].push({
                x: new Date(dates[0], dates[1] - 1),
                y: null
              });
              dpsB[j].push({
                x: new Date(dates[0], dates[1] - 1),
                y: null
              });
            }
            else if (hData[j][3] !== "") {
              if (hData[j][3] === "HB") {
                dps[j].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: parseInt(hData[j][0])
                });
                dpsB[j].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
                });
              }
              else {
                dps[j].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "triangle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: parseInt(hData[j][0])
                });
                dpsB[j].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "triangle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
                });
              }
            } else {
              dps[j].push({
                shisho: hData[j][2],
                label: hData[j][3],
                prevHeyaName: hData[j][5],
                url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                x: new Date(dates[0], dates[1] - 1),
                y: parseInt(hData[j][0])
              });
              dpsB[j].push({
                shisho: hData[j][2],
                label: hData[j][3],
                prevHeyaName: hData[j][5],
                url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                x: new Date(dates[0], dates[1] - 1),
                y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
              });
            }
          }
        }
      }
    }
    chart.render();
  }

  $.get("https://raw.githubusercontent.com/chiyotasuke/chiyotasuke/main/heya_data_def.csv",
    getDataDef);

  function getDataDef(csv) {
    var csvLines = heya = dates = [];
    var hData = Create2DArray(HEYA_COUNT + 1);

    csvLines = csv.split(/[\r?\n|\r|\n]+/);
    for (var i = 1; i < csvLines.length; i++) {
      if (csvLines[i].length > 0) {
        heya = csvLines[i].split(",");
        dates = heya[0].split(".");
        for (var j = 0; j < DEF_HEYA_COUNT; j++) {
          hData[j] = heya[j+1].split("-");
          if (heya[j+1] !== "") {
            if (hData[j][0] === "") {
              dps[j+HEYA_COUNT+1].push({
                x: new Date(dates[0], dates[1] - 1),
                y: null
              });
              dpsB[j+HEYA_COUNT+1].push({
                x: new Date(dates[0], dates[1] - 1),
                y: null
              });
            }
            else if (hData[j][3] !== "") {
              if (hData[j][3] === "HB") {
                dps[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: parseInt(hData[j][0])
                });
                dpsB[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
                });
              }
              else if (hData[j][3] === "HT"){
                dps[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "triangle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: parseInt(hData[j][0])
                });
                dpsB[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "white",
                  markerType: "triangle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
                });
              } else {
                dps[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "black",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: parseInt(hData[j][0])
                });
                dpsB[j+HEYA_COUNT+1].push({
                  markerSize: 6,
                  markerColor: "black",
                  markerType: "circle",
                  markerBorderThickness: 1,
                  markerBorderColor: "black",
                  shisho: hData[j][2],
                  prevHeyaName: hData[j][5],
                  url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                  dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                  x: new Date(dates[0], dates[1] - 1),
                  y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
                });
              }
            } else {
              dps[j+HEYA_COUNT+1].push({
                shisho: hData[j][2],
                label: hData[j][3],
                prevHeyaName: hData[j][5],
                url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                x: new Date(dates[0], dates[1] - 1),
                y: parseInt(hData[j][0])
              });
              dpsB[j+HEYA_COUNT+1].push({
                shisho: hData[j][2],
                label: hData[j][3],
                prevHeyaName: hData[j][5],
                url: "https://sumodb.sumogames.de/Banzuke.aspx?b=" + dates[0] + 
                dates[1] + "&heya=" + hData[j][4] + "&shusshin=-1",
                x: new Date(dates[0], dates[1] - 1),
                y: [parseInt(hData[j][0]), parseInt(hData[j][0]) -
                  parseInt(hData[j][1])]
              });
            }
          }
        }
      }
    }
    chart.render();
  }

  var viewportButton = document.getElementById("setViewport");
  var vRange = document.getElementById("viewportRange");
  viewportButton.addEventListener("click", setViewport);


  vRange.addEventListener("keydown", function (e) {
    if (e.code === "Enter") {  //checks whether the pressed key is "Enter"
        setViewport();
    }
  });


  //Function for setting viewport
  function setViewport() {
    var dates = minDates = maxDates = [];

    if (vRange.value) {
      dates = vRange.value.split("-");
      minDates = dates[0].split(".");
      maxDates = dates[1].split(".");
    }

    chart.axisX[0].set("viewportMinimum", new Date(minDates[0], minDates[1] - 1));
    chart.axisX[0].set("viewportMaximum", new Date(maxDates[0], maxDates[1] - 1));
    updateViewportText();
  }

  var resetViewportButton = document.getElementById("resetViewport");
  resetViewportButton.addEventListener("click", resetViewport);

  function resetViewport() {
    chart.axisX[0].set("viewportMinimum", null);
    chart.axisX[0].set("viewportMaximum", null);
    updateViewportText();
    vRange.value = "";
  }

  $(".period").click( function() {
    var period = this.id;
    var dates = [];
    var minXValue = [];

    dates = viewportX.value.split("-");
    minXValue = dates[1].split(".");
    minXValue[0] = parseInt(minXValue[0]);
    
    switch(period) {
      case "5y":
        minXValue[0] = minXValue[0] - 5;
        break;
      case "10y":
        minXValue[0] = minXValue[0] - 10;
        break;
      case "20y":
        minXValue[0] = minXValue[0] - 20;
        break;
      default:
        minXValue[0] = minXValue[0] - 50;
    }
    
    chart.axisX[0].set("viewportMinimum", new Date(minXValue[0], minXValue[1] - 1));

    updateViewportText();
  });


  var legendListId = document.getElementById("legendList");
  customLegends();

  function customLegends() {
    for (var i = 0; i <= HEYA_COUNT; i++) { 
      var li = document.createElement("li");
      li.style.color = "#A9A9A9";
      li.appendChild(document.createTextNode(hNamesAlpha[i]));
      legendListId.appendChild(li); 
      $('li').each(function (i) {
          $(this).attr('id', "name" + String(i));
      });
    }
      
    $('li').mouseover(function(event) {
      for (var i = 0; i <= HEYA_COUNT; i++) {
        if (chart.options.data[i].name === this.innerText) {
          chart.options.data[i].lineThickness = 3;
          chart.options.data[i].fillOpacity = .6;
          chart.options.data[i].indexLabelFontWeight = "bolder";
        }
      }
      chart.render();
    });

    $('li').mouseout(function(event) {
      for (var i = 0; i <= HEYA_COUNT; i++) {
        if (chart.options.data[i].name === this.innerText) {
          chart.options.data[i].lineThickness = 2;
          chart.options.data[i].fillOpacity = .4;
          chart.options.data[i].indexLabelFontWeight = "normal";
        }
      }
      chart.render();
    });

    $('li').click(function(event) {
      for (var i = 0; i <= HEYA_COUNT; i++) {
        if (chart.options.data[i].name === this.innerText) {
          if (typeof(chart.options.data[i].visible) === "undefined" || 
            chart.options.data[i].visible) {
            chart.options.data[i].visible = false;
            this.style.color = "#A9A9A9";
            this.style.fontWeight = "normal";
          } else {
            if (document.getElementById("toggleSekitori").checked === true) {
              chart.data[i].set("type", "rangeArea");
              chart.options.data[i].dataPoints = dpsB[i];
            }
            else {
              chart.data[i].set("type", "line");
              chart.options.data[i].dataPoints = dps[i];
            }
            chart.options.data[i].visible = true;
            this.style.color = dataColors[i];
            this.style.fontWeight = "bold";
          }
        }
      }
      chart.render();
      updateViewportText();
    });
  }

  var legendListIdDef = document.getElementById("legendListDef");
  customLegendsDef();

  function customLegendsDef() {
    for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++)  { 
      var li = document.createElement("li");
      li.style.color = "#A9A9A9";
      li.appendChild(document.createTextNode(hNamesDefAlpha[i-(HEYA_COUNT + 1)]));
      legendListIdDef.appendChild(li); 
      $('li').each(function (i) {
          $(this).attr('id', "name" + String(i));
      });
    }
      
    $('li').mouseover(function(event) {
      for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
        if (chart.options.data[i].name === this.innerText) {
          chart.options.data[i].lineThickness = 3;
          chart.options.data[i].fillOpacity = .6;
          chart.options.data[i].indexLabelFontWeight = "bolder";
        }
      }
      chart.render();
    });

    $('li').mouseout(function(event) {
      for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
        if (chart.options.data[i].name === this.innerText) {
          chart.options.data[i].lineThickness = 2;
          chart.options.data[i].fillOpacity = .4;
          chart.options.data[i].indexLabelFontWeight = "normal";
        }
      }
      chart.render();
    });

    $('li').click(function(event) {
      for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
        if (chart.options.data[i].name === this.innerText) {
          if (typeof(chart.options.data[i].visible) === "undefined" || 
            chart.options.data[i].visible) {
            chart.options.data[i].visible = false;
            this.style.color = "#A9A9A9";
            this.style.fontWeight = "normal";
          } else {
            if (document.getElementById("toggleSekitori").checked === true) {
              chart.data[i].set("type", "rangeArea");
              chart.options.data[i].dataPoints = dpsB[i];
            }
            else {
              chart.data[i].set("type", "line");
              chart.options.data[i].dataPoints = dps[i];
            }
            chart.options.data[i].visible = true;
            this.style.color = dataColors[i];
            this.style.fontWeight = "bold";
          }
        }
      }
      chart.render();
      updateViewportText();
    });
  }

  var hideAllButton = document.getElementById("hideAll");
  hideAllButton.addEventListener("click", hideAll);

  function hideAll() {
    const legend = [...document.querySelectorAll("li")];
    for (var i = 0; i < DEF_HEYA_COUNT + HEYA_COUNT + 1; i++) {
      if (chart.options.data[i].visible) 
        chart.options.data[i].visible = false;
      legend[i].style.color = "#A9A9A9";
      legend[i].style.fontWeight = "normal";
    }
    chart.render();
    updateViewportText();
  }

  var coll = document.getElementsByClassName("collapsible");

  for (var i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }

  var sortNames = document.getElementById("sortDropdown");
  sortNames.addEventListener("change", function() {
    switch(sortNames.value) {
      case "alphabetic":
        for (var i = 0; i <= HEYA_COUNT; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesAlpha[i];
        }
        for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesDefAlpha[i-(HEYA_COUNT + 1)];
        }
        break;
      case "oldest":
        for (var i = 0; i <= HEYA_COUNT; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesOld[i];
        }
        for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesDefOld[i-(HEYA_COUNT + 1)];
        }
        break;
      default:
        for (var i = 0; i <= HEYA_COUNT; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesAlpha[i];
        }
        for (var i = HEYA_COUNT + 1; i < HEYA_COUNT + DEF_HEYA_COUNT + 1; i++) {
          var li = document.getElementById("name" + String(i));
          li.innerText = hNamesDefClo[i-(HEYA_COUNT + 1)];
        }
    }
    hideAll();
  });

}

    </script>
  </head>
  <body>
    <body>
      <title>Heya Graph</title>
      <div id="header">
        <a id="titleText">Heya Graph</a><a href="https://sumodb.sumogames.de/">Sumo Reference</a><a id="creditText">data compiled from</a>
      </div>
      <fieldset id="graphView">
        <div class="setViewportRange">
          Set view range: <input id="viewportRange" type="text" placeholder="yyyy.m - yyyy.m" autocomplete="off"> 
          <button id="setViewport" type="button" value="viewportButton">Set</button>
        </div>
        <button id="resetViewport" type="button" value="resetViewportButton">↻ Reset</button>
        <div id="range-selector">
          Zoom to: 
          <input type="button" id="5y" class="period ui-button" value="5 yrs"/>
          <input type="button" id="10y" class="period ui-button" value="10 yrs"/>
          <input type="button" id="20y" class="period ui-button" value="20 yrs"/>
          <input type="button" id="50y" class="period ui-button" value="50 yrs"/>
        </div>
      </fieldset>
    <div id="chartContainer"></div>
    <fieldset id="graphSettings">
      <div class="currentViewport">
        <label>Viewing: <input id="viewportX" type="text" size=11  placeholder=". . ." readonly></label>
      </div>
      <label><input id="toggleSekitori" type="checkbox" name="checkbox" autocomplete="off">Enable Sekitori</label>
      <button id="hideAll" type="button" value="hideAllButton">Hide All Graphs</button>
      <label id="sortHNames">Sort heya names </label>
        <select id="sortDropdown" autocomplete="off">
          <option value="alphabetic">alphabetically</option>
          <option value="oldest">oldest first</option>
          <option value="closed">recently closed first</option>
        </select>
    </fieldset>
    <label><div id="legendTitle">Active heya</div></label>
    <div id="legends">
      <ul id="legendList">
      </ul>
    </div>
    <label><div id="legendTitleDef">Defunct heya</div></label>
    <div id="legendsDef">
      <ul id="legendListDef">
      </ul>
    </div>
    <button type="button" class="collapsible">▾ INFORMATION</button>
    <div class="content">
      <p><div class="whiteCircle"></div> - Heya Opening</p>
      <p>△ - Heya Takeover</p>
      <p><div class="blackCircle"></div> - Heya Closure</p>
      <p>- Click-and-drag across graph to zoom in</p>
      <p>- Clicking on data points redirects you to Sumo Reference banzuke page with heya filtered</p>
      <p>- Data on the lighter pink area of the graph (before 1988.03) can be unreliable since its banzuke contain rikishi with no heya information</p>
      <p>- Data on the darker pink area of the graph (before 1934.05) is mostly incomplete, as many of the lower division ranks are missing</p>
    </div>
    <span id="display"></span>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type='text/javascript' src="scripts/canvasjs_modified.min.js"></script>
  </body>
</html>
